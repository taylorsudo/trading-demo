{% extends "layout.html" %}

{% block title %}
Portfolio
{% endblock %}

{% block main %}

<table class="table table-striped">
    <thead>
        <tr>
            <th class="text-start">Symbol</th>
            <th class="text-end">Shares</th>
            <th class="text-end">Price</th>
            <th class="text-end">TOTAL</th>
        </tr>
    </thead>
    <tbody>
        {% for row in rows %}
        <tr>
            <td class="text-start">{{ row['symbol'] }}</td>
            <td class="text-end">{{ row['shares'] | int }}</td>
            <td class="text-end">{{ row['price'] | usd }}</td>
            <td class="text-end">{{ row['total'] | usd }}</td>
        </tr>
        {% endfor %}
    </tbody>
    <tfoot>
        <tr>
            <td class="border-0 fw-bold text-end" colspan="3">Cash</td>
            <td class="border-0 text-end">{{ cash | usd }}</td>
        </tr>
        <tr>
            <td class="border-0 fw-bold text-end" colspan="3">TOTAL</td>
            <td class="border-0 w-bold text-end">{{ total | usd }}</td>
        </tr>
    </tfoot>
</table>

<article class="container mt-5">
    <nav class="nav nav-pills nav-justified" id="timeScaleTabs">
        {% for tab in tabs %}
        <a class="nav-link {% if loop.first %}active{% endif %}" id="{{ tab }}" data-bs-toggle="pill"
            href="#{{ tab }}-content">{{ tab }}</a>
        {% endfor %}
    </nav>

    <section class="tab-content mt-2">
        {% for tab in tabs %}
        <article class="tab-pane fade {% if loop.first %}show active{% endif %}" id="{{ tab }}-content">
            <!-- Content for {{ tab }} tab -->
        </article>
        {% endfor %}
    </section>
</article>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Load initial content on page load
        var initialTab = '{{ tabs[0] }}';  // Get the initial tab ID here
        loadTabContent(initialTab);

        // Event handling for tab clicks
        var tabs = document.querySelectorAll('#timeScaleTabs a');

        tabs.forEach(function(tab) {
            tab.addEventListener('click', function(e) {
                e.preventDefault();

                // Remove 'active' class from all tabs
                tabs.forEach(function(t) {
                    t.classList.remove('active');
                });

                // Add 'active' class to the clicked tab
                this.classList.add('active');

                // Load content for the selected tab
                var selectedTab = this.getAttribute('id');
                loadTabContent(selectedTab);
            });
        });

        function loadTabContent(tabId) {
            // Fetch data for the selected tab using XMLHttpRequest
            var xhr = new XMLHttpRequest();
            xhr.open('GET', '/load_content?tab_id=' + tabId, true);
            xhr.onreadystatechange = function() {
                if (xhr.readyState === 4 && xhr.status === 200) {
                    // Update the content of the corresponding tab
                    document.getElementById(tabId + '-content').innerHTML = xhr.responseText;
                }
            };
            xhr.send();
        }
    });
</script>

{% endblock %}
